<project name="HBase test" default="test14" basedir=".">

	<import><javaresource name="com/anttoolkit/anttoolkit.xml"/></import>

	<mongoConfig id="mongoDB" database="mydb">
		<server>EVHUBUDSD21BE.budapest.epam.com:27017</server>
	</mongoConfig>

	<target name="test1">
		<mongoSession mongoConfig="mongoDB">
			<mongoCheckCollection collection="wotio" property="exist"/>
			<echo>wotio: ${exist}</echo>

			<mongoCheckCollection collection="wotio3" property="exist"/>
			<echo>wotio3: ${exist}</echo>
		</mongoSession>
	</target>

	<target name="test2">
		<mongoSession mongoConfig="mongoDB">
			<mongoCreateCollection collection="myTest" capped="true" maxSize="1048576" maxCount="1000"/>
		</mongoSession>
	</target>

	<target name="test3">
		<mongoSession mongoConfig="mongoDB">
			<mongoInsert collection="myTest">
				{
					"name": "Bob",
					"age": 12,
					"sex": "male",
					"position": "accountant",
					"photo": { "$binary": "$FILE(${basedir}/test.jpg)", "$type": 0 }
				}
			</mongoInsert>
		</mongoSession>
	</target>

	<target name="test4">
		<mongoSession mongoConfig="mongoDB">
			<mongoUpdate collection="myTest">
				<query>
					{ age: { $gt: 6 } }
				</query>

				<update>
					{
						$set: { updated: true },
						$set: { message: "hello world" },
						$set: { title: "Announcement" }
					}
				</update>

				<options>
					{
						multi: true,
						upsert: true,
						writeConcern: { w: "majority", wtimeout: 5000 }
					}
				</options>
			</mongoUpdate>
		</mongoSession>
	</target>

	<target name="test5">
		<mongoSession mongoConfig="mongoDB">
			<mongoRemove collection="myTest">
				{ call_sign: "WTIC" }
			</mongoRemove>
		</mongoSession>
	</target>

	<target name="test6">
		<mongoSession mongoConfig="mongoDB">
			<mongoDropCollection collection="testData"/>
		</mongoSession>
	</target>

	<target name="test7">
		<mongoSession mongoConfig="mongoDB">
			<mongoCount collection="myTest" property="count">
				{name: "Bob"}
			</mongoCount>
		</mongoSession>
		<echo>count=${count}</echo>
	</target>

	<target name="test8">
		<mongoSession mongoConfig="mongoDB">
			<mongoCopyCollection src="myTest" dest="myTestCopy"/>
		</mongoSession>
	</target>

	<target name="test9">
		<mongoSession mongoConfig="mongoDB">
			<mongoFindLoop collection="wotio"
						   query="{alias: 'TV'}"
						   projection="{_id: 1, call_sign: 1, cc_text: 1}"
						   skip="1" limit="3"
						   property="json">

				<echo>----------------------------------------------------</echo>
				<echo>${json}</echo>

			</mongoFindLoop>
		</mongoSession>
	</target>

	<target name="test10">
		<mongoSession mongoConfig="mongoDB">
			<mongoCreateIndex collection="myTest">
				<keys>{name: 1}</keys>
				<options>{name: "test", expireAfterSeconds: 100000}</options>
			</mongoCreateIndex>
		</mongoSession>
	</target>

	<target name="test11">
		<mongoSession mongoConfig="mongoDB">
			<mongoCheckIndexExists collection="myTest" keys="{name: 1}" property="exist1"/>
			<mongoCheckIndexExists collection="myTest" name="test" property="exist2"/>
		</mongoSession>
		<echo>exist1=${exist1}</echo>
		<echo>exist1=${exist2}</echo>
	</target>

	<target name="test12">
		<mongoSession mongoConfig="mongoDB">
			<mongoDropIndex collection="myTest" keys="{name: 1}"/>
		</mongoSession>
	</target>

	<target name="test13">
		<mongoSession mongoConfig="mongoDB">
			<mongoPutToGridFs file="test.jpg" bucket="photos" chunkSize="261120" property="objectId"/>
		</mongoSession>
		<echo>File id: ${objectId}</echo>
	</target>

	<target name="test14">
		<mongoSession mongoConfig="mongoDB">
			<mongoGetFromGridFs objectId="540c076dda064b2ae9164740" bucket="photos" file="test1.jpg"/>
		</mongoSession>
	</target>

</project>